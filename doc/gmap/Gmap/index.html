<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gmap (gmap.Gmap)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">gmap</a> &#x00BB; Gmap</nav><h1>Module <code>Gmap</code></h1><p>Heterogenous maps over a GADT.</p><p>The motivation for this library originated in the area of parsing binary network protocols, which often contain options and extensions in the form of tag, length, value encodings: the set of tags and corresponding values is specified in some Internet standard, and later extended by using a global registry. Examples are IP options, TCP options, DNS resource records, TLS hello extensions, X.509v3 extensions, ... These extension mechanisms usually include the invariant that each tag may only be present once.</p><p>A more naive approach is to use a variant type of all known tag-value combinations and storing these in an association list while parsing, but verifying the uniqueness invariant takes quadratic (<code>O(n^2)</code>) time, and retrieving a specific option is only doable in linear <code>O(n)</code> time. Additionally, packing and unpacking is required with the variant type solution.</p><p>In gmap, <a href="https://en.wikipedia.org/wiki/Generalized_algebraic_data_type">GADTs</a> are used to provide key-dependent value types: each GADT constructor carries their value type. The underlying storage mechanism uses OCaml's stdlib <a href="http://caml.inria.fr/pub/docs/manual-ocaml/libref/Map.html">Map</a> type: Lookup takes <code>O(log n)</code> time. The above mentioned uniqueness invariant can be preserved while constructing the gmap if for insertion into the map only <a href="module-type-S/index.html#val-update"><code>S.update</code></a> and <a href="module-type-S/index.html#val-add_unless_bound"><code>S.add_unless_bound</code></a> are used (<a href="module-type-S/index.html#val-add"><code>S.add</code></a> replaces the existing binding if present).</p><p>A small example:</p><pre><code class="ml">type _ key =
  | I : int key
  | S : string key

module K = struct
  type 'a t = 'a key

  let compare : type a b. a t -&gt; b t -&gt; (a, b) Gmap.Order.t = fun t t' -&gt;
    let open Gmap.Order in
    match t, t' with
    | I, I -&gt; Eq | I, _ -&gt; Lt | _, I -&gt; Gt
    | S, S -&gt; Eq
end

module GM = Gmap.Make(K)</code></pre><p>Using <code>GM</code> is done as follows:</p><pre><code class="ml">match GM.find I (GM.singleton I 10) with
| Some x -&gt; x * x
| None -&gt; 0</code></pre><p><em>0.3.0 - <a href="https://github.com/hannesm/gmap">homepage</a></em></p></header><dl><dt class="spec module" id="module-Order"><a href="#module-Order" class="anchor"></a><code><span class="keyword">module</span> <a href="Order/index.html">Order</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Ordering.</p></dd></dl><dl><dt class="spec module-type" id="module-type-KEY"><a href="#module-type-KEY" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-KEY/index.html">KEY</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Key.</p></dd></dl><dl><dt class="spec module-type" id="module-type-S"><a href="#module-type-S" class="anchor"></a><code><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a> = <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Output signature of the functor <a href="Make/index.html"><code>Make</code></a></p></dd></dl><dl><dt class="spec module" id="module-Make"><a href="#module-Make" class="anchor"></a><code><span class="keyword">module</span> <a href="Make/index.html">Make</a> : <span class="keyword">functor</span> (<a href="Make/argument-1-Key/index.html">Key</a> : <a href="index.html#module-type-KEY">KEY</a>) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Functor for heterogenous maps whose keys are provided by <code>Key</code>.</p></dd></dl></div></body></html>